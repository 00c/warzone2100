-- Generated by wz2lua (implementation file)
version(0) --- version of the script API this script is written for

-- the two computer players

-- the player and nexus colour
playerColour = 0
nexusColour = 0
oldColour = 0

-- gamma base areas

-- trip regions for springing (NEXUS LZs)

-- number of player droids to get into the gamma base

-- the message when gamma base changes player

count1 = 0
count2 = 0
gammaStrucTot = 0
gammaStrucNow = 0
gammaDroidTot = 0
nexusStrucTot = 0
nexusStrucNow = 0

-- trigger trapTimedTrig(wait, 6000);	//10min delay after player has seen gamma base for auto trigger
-- check for gamma base losing


function start()
	playerColour = getPlayerColour(player)
	-- store the old colour so we can reset it later
	oldColour = getPlayerColour(enemy[1])
	-- get the enemy colour
	nexusColour = getPlayerColour(enemy[0])
	setPlayerColour(playerColour, enemy[1])
	
	-- setup alliances done in generic script!!
	-- createAlliance(enemy[0], enemy[1]);	//Nexus and Gamma
	-- createAlliance(player, enemy[1]);	//player and Gamma
	
	-- store total structures for gamma base
	gammaStrucTot = numStructsInArea(enemy[1], regionsX1[1], regionsY1[1], regionsX2[1], regionsY2[1])
	gammaDroidTot = getDroidCount(enemy[1])
	nexusStrucTot = numStructsInArea(enemy[0], X1[1], Y1[1], X2[1], Y2[1]) + numStructsInArea(enemy[0], X1[0], Y1[0], X2[0], Y2[0])
	deactivateEvent(start)
end
callbackEvent(start, CALL_GAMEINIT)

function powStuff()
	addPower(player, power)
	playSound(powTransSnd, player)
end
delayedEvent(powStuff, 0.5)


-- remove briefing
function killMessage()
	deactivateEvent(killMessage)
end

function makeFight()
	breakAlliance(enemy[0], enemy[1])
	-- setEventTrigger(trapTimed, trapTimedTrig);	//only allow fight for set period before springing trap
	deactivateEvent(makeFight)
end
conditionalEvent(makeFight, "seenStructInArea(player, enemy[1], false, regionsX1[1], regionsY1[1], regionsX2[1], regionsY2[1])", 0.5)

function trapTimed()
	gammaStrucNow = numStructsInArea(enemy[1], regionsX1[1], regionsY1[1], regionsX2[1], regionsY2[1])
	nexusStrucNow = numStructsInArea(enemy[0], X1[1], Y1[1], X2[1], Y2[1]) + numStructsInArea(enemy[0], X1[0], Y1[0], X2[0], Y2[0])
	if (gammaStrucNow < gammaStrucTot - 1) or (getDroidCount(enemy[1]) < gammaDroidTot - 1) or (nexusStrucNow < nexusStrucTot) then
		deactivateEvent(trapSprung)
		deactivateEvent(trapTimed)
		-- immediate
		delayedEvent(changeGammaBase, 0.0)
	end
end
repeatingEvent(trapTimed, 2.5)

function trapSprung()
	deactivateEvent(trapSprung)
	deactivateEvent(trapTimed)
	-- immediate
	delayedEvent(changeGammaBase, 0.0)
end
callbackEvent(trapSprung, CALL_ELECTRONIC_TAKEOVER)

function changeGammaBase()
	deactivateEvent(trapSprung)
	deactivateEvent(trapTimed)
	deactivateEvent(makeFight)
	-- need incoming transmission here!
	playSound(incomingSnd, player)
	pause(20/10.0)
	callbackEvent(killMessage, CALL_VIDEO_QUIT)
	addMessage(gammaMessage, MISS_MSG, player, true)
	pause(10/10.0)
	setMissionTime(secondMissionTime/10.0)
	setPlayerColour(nexusColour, enemy[1])
	breakAlliance(player, enemy[1])
	createAlliance(enemy[0], enemy[1])
	deactivateEvent(changeGammaBase)
end
conditionalEvent(changeGammaBase, "numDroidsInArea(player, regionsX1[0], regionsY1[0], regionsX2[0], regionsY2[0]) > 0", 1.9)


---------- stubs ----------

if seenStructInArea == nil then seenStructInArea = function() print("stub: seenStructInArea"); return 0 end end
if setEventTrigger == nil then setEventTrigger = function() print("stub: setEventTrigger"); return 0 end end
if addPower == nil then addPower = function() print("stub: addPower"); return 0 end end
if numStructsInArea == nil then numStructsInArea = function() print("stub: numStructsInArea"); return 0 end end
if numDroidsInArea == nil then numDroidsInArea = function() print("stub: numDroidsInArea"); return 0 end end
if breakAlliance == nil then breakAlliance = function() print("stub: breakAlliance"); return 0 end end
if getPlayerColour == nil then getPlayerColour = function() print("stub: getPlayerColour"); return 0 end end
if droidInArea == nil then droidInArea = function() print("stub: droidInArea"); return 0 end end
if setPlayerColour == nil then setPlayerColour = function() print("stub: setPlayerColour"); return 0 end end
if getDroidCount == nil then getDroidCount = function() print("stub: getDroidCount"); return 0 end end
if pause == nil then pause = function() print("stub: pause"); return 0 end end
if createAlliance == nil then createAlliance = function() print("stub: createAlliance"); return 0 end end
if setMissionTime == nil then setMissionTime = function() print("stub: setMissionTime"); return 0 end end
if addMessage == nil then addMessage = function() print("stub: addMessage"); return 0 end end
if playSound == nil then playSound = function() print("stub: playSound"); return 0 end end
